<ion-header [translucent]="true">
  <ion-toolbar color="primary">
    <ion-title>Squad Maker</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div *ngIf="!(authService.isAuthenticated$ | async)" class="login-prompt">
    <ion-card>
      <ion-card-header>
        <ion-card-title>Bem-vindo ao Squad Maker!</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <p>Faça login para criar e gerenciar seus grupos.</p>
        <app-login-button></app-login-button>
      </ion-card-content>
    </ion-card>
  </div>
  <div *ngIf="authService.isAuthenticated$ | async">
  <div *ngIf="currentTab === 'groups'">
    <ion-list>
      <ion-list-header>
        <ion-label>Grupos Salvos</ion-label>
        <ion-button fill="clear" size="small" (click)="newGroup()">
          <ion-icon slot="start" name="add"></ion-icon>
          Novo Grupo
        </ion-button>
      </ion-list-header>
    </ion-list>
    
    <div *ngIf="groups.length === 0" class="empty-state">
      <ion-icon name="people-outline" size="large"></ion-icon>
      <p>Nenhum grupo criado ainda</p>
      <ion-button fill="outline" (click)="newGroup()">Criar Primeiro Grupo</ion-button>
    </div>

    <ion-list *ngIf="groups.length > 0">
      <ion-item *ngFor="let group of groups; let i = index" class="group-item">
        <ion-label>
          <h3>{{ group.name }}</h3>
          <p>{{ group.members.length }} membro(s)</p>
        </ion-label>
        <ion-buttons slot="end">
          <ion-button fill="clear" size="small" (click)="editGroup(i)">
            <ion-icon name="create-outline"></ion-icon>
          </ion-button>
          <ion-button fill="clear" size="small" color="danger" (click)="deleteGroup(i)">
            <ion-icon name="trash-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-item>
    </ion-list>
  </div>

  <!-- Aba de Criar/Editar Grupo -->
  <div *ngIf="currentTab === 'edit-group'">
    <ion-list>
      <ion-item>
        <ion-label position="stacked">Nome do Grupo</ion-label>
        <ion-input 
          [(ngModel)]="currentGroup.name" 
          placeholder="Ex: Time de Futebol">
        </ion-input>
      </ion-item>
      
      <ion-list-header>
        <ion-label>Membros do Grupo</ion-label>
      </ion-list-header>

      <ion-item *ngFor="let member of currentGroup.members; let i = index" class="person-item">
        <ion-input 
          [(ngModel)]="member.name" 
          placeholder="Nome do membro">
        </ion-input>
        <ion-checkbox 
          slot="end" 
          [(ngModel)]="member.active">
        </ion-checkbox>
        <ion-button 
          fill="clear" 
          color="danger" 
          size="small" 
          (click)="removeMember(i)">
          <ion-icon name="close-circle"></ion-icon>
        </ion-button>
      </ion-item>

      <ion-item>
        <ion-button fill="clear" slot="start" (click)="addMember()">
          <ion-icon slot="start" name="person-add"></ion-icon>
          Adicionar Membro
        </ion-button>
      </ion-item>

      <ion-item>
        <ion-button expand="block" (click)="saveGroup()">Salvar Grupo</ion-button>
        <ion-button expand="block" fill="outline" (click)="cancelEdit()">Cancelar</ion-button>
      </ion-item>
    </ion-list>
  </div>

  <!-- Aba de Gerar Times -->
  <div *ngIf="currentTab === 'generate-teams'">
    <ion-list>
      <ion-item>
        <ion-label position="stacked">Número de Times</ion-label>
        <ion-input 
          type="number" 
          [(ngModel)]="teamsCount" 
          min="1">
        </ion-input>
      </ion-item>
      
      <ion-item>
        <ion-label>Selecionar Grupo</ion-label>
        <ion-select 
          [(ngModel)]="selectedGroupIndex" 
          placeholder="Escolha um grupo"
          (ionChange)="onGroupSelectChange()">
          <ion-select-option 
            *ngFor="let group of groups; let i = index" 
            [value]="i">
            {{ group.name }}
          </ion-select-option>
        </ion-select>
      </ion-item>

      <ion-list-header *ngIf="selectedGroup">
        <ion-label>Membros (marque os que vão jogar)</ion-label>
      </ion-list-header>

      <ion-item *ngFor="let member of selectedGroup?.members; let i = index">
        <ion-label>{{ member.name }}</ion-label>
        <ion-checkbox 
          slot="end" 
          [(ngModel)]="member.active">
        </ion-checkbox>
      </ion-item>

      <ion-item>
        <ion-button 
          expand="block" 
          (click)="generateTeams()" 
          [disabled]="!selectedGroup">
          Gerar Times
        </ion-button>
      </ion-item>
    </ion-list>

    <div *ngIf="generatedTeams.length > 0" class="teams-result">
      <ion-card *ngFor="let team of generatedTeams; let i = index" class="team-card">
        <ion-card-header>
          <ion-card-title class="team-title">Time {{ i + 1 }}</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <div *ngFor="let member of team" class="team-member">• {{ member }}</div>
        </ion-card-content>
      </ion-card>
    </div>

    <div *ngIf="groups.length === 0" class="empty-state">
      <p>Nenhum grupo disponível. Crie um grupo primeiro.</p>
    </div>
  </div>
  </div>
  <ion-content *ngIf="currentTab === 'matches'">
    <ion-list>
      <ion-list-header>
        <ion-label>Registrar Nova Partida</ion-label>
      </ion-list-header>
  
      <!-- Formulário Nova Partida -->
      <ion-card>
        <ion-card-header>
          <ion-card-title>Nova Partida</ion-card-title>
        </ion-card-header>
        <ion-card-content>
          <!-- Seleção de Times -->
          <ion-item>
            <ion-label position="stacked">Time A</ion-label>
            <ion-select 
              [(ngModel)]="newMatch.teamA" 
              multiple 
              placeholder="Selecione jogadores Time A"
              [compareWith]="compareTeams">
              <ion-select-option 
                *ngFor="let team of generatedTeams" 
                [value]="team">
                {{ team.join(', ') }}
              </ion-select-option>
            </ion-select>
          </ion-item>
  
          <ion-item>
            <ion-label position="stacked">Time B</ion-label>
            <ion-select 
              [(ngModel)]="newMatch.teamB" 
              multiple 
              placeholder="Selecione jogadores Time B"
              [compareWith]="compareTeams">
              <ion-select-option 
                *ngFor="let team of generatedTeams" 
                [value]="team">
                {{ team.join(', ') }}
              </ion-select-option>
            </ion-select>
          </ion-item>
  
          <!-- Placar -->
          <ion-item>
            <ion-label position="stacked">Placar</ion-label>
            <div class="score-inputs">
              <ion-input 
                type="number" 
                [(ngModel)]="newMatch.scoreA" 
                placeholder="0"
                min="0"
                class="score-input">
              </ion-input>
              <span class="vs-text">VS</span>
              <ion-input 
                type="number" 
                [(ngModel)]="newMatch.scoreB" 
                placeholder="0"
                min="0"
                class="score-input">
              </ion-input>
            </div>
          </ion-item>
  
          <!-- Botão Registrar -->
          <ion-button 
            expand="block" 
            (click)="registerMatch()"
            [disabled]="!canRegisterMatch()">
            <ion-icon slot="start" name="trophy"></ion-icon>
            Registrar Partida
          </ion-button>
        </ion-card-content>
      </ion-card>
  
      <!-- Histórico de Partidas -->
      <ion-list-header>
        <ion-label>Histórico de Partidas</ion-label>
        <ion-button fill="clear" size="small" (click)="loadMatches()">
          <ion-icon slot="start" name="refresh"></ion-icon>
          Atualizar
        </ion-button>
      </ion-list-header>
  
      <div *ngIf="matches.length === 0" class="empty-state">
        <ion-icon name="trophy-outline" size="large"></ion-icon>
        <p>Nenhuma partida registrada ainda</p>
        <p class="subtext">Registre a primeira partida para começar o histórico!</p>
      </div>
  
      <ion-card *ngFor="let match of matches" class="match-card">
        <ion-card-header>
          <ion-card-title class="match-title">
            <span [class.winner]="match.scoreA > match.scoreB">{{ match.scoreA }}</span>
            <span class="vs">VS</span>
            <span [class.winner]="match.scoreB > match.scoreA">{{ match.scoreB }}</span>
          </ion-card-title>
         <div class="match-date">
        {{ match.date | date:'dd/MM/yyyy HH:mm' }}
      </div>
        </ion-card-header>
        <ion-card-content>
          <div class="teams-container">
            <div class="team-section">
              <h4>Time A</h4>
              <div *ngFor="let player of match.teamA" class="player-name">
                {{ player }}
              </div>
            </div>
            <div class="team-section">
              <h4>Time B</h4>
              <div *ngFor="let player of match.teamB" class="player-name">
                {{ player }}
              </div>
            </div>
          </div>
          
          <!-- Resultado -->
          <div class="match-result" [class.win]="match.scoreA > match.scoreB" [class.loss]="match.scoreA < match.scoreB">
            <ion-icon 
              [name]="match.scoreA > match.scoreB ? 'trophy' : 'medal'"
              [color]="match.scoreA > match.scoreB ? 'success' : 'warning'">
            </ion-icon>
            <span *ngIf="match.scoreA > match.scoreB">Vitória do Time A!</span>
            <span *ngIf="match.scoreA < match.scoreB">Vitória do Time B!</span>
            <span *ngIf="match.scoreA === match.scoreB">Empate!</span>
          </div>
        </ion-card-content>
      </ion-card>
    </ion-list>
  </ion-content>
</ion-content>


<ion-footer *ngIf="currentTab !== 'edit-group'">
  <ion-toolbar>
    <ion-segment [value]="currentTab" (ionChange)="onTabChange($event)">
      <ion-segment-button value="groups">
        <ion-label>Grupos</ion-label>
      </ion-segment-button>
      <ion-segment-button value="generate-teams">
        <ion-label>Gerar Times</ion-label>
      </ion-segment-button>
      <ion-segment-button value="matches">
        <ion-label>Partidas</ion-label>
      </ion-segment-button>
    </ion-segment>
    
  </ion-toolbar>
</ion-footer>

<ion-footer class="custom-footer">
  <ion-toolbar>
    <div class="footer-content">
      <ion-text color="medium">
        Powered by 
        <span class="flairtech-text">FlairTech</span>
      </ion-text>
    </div>
  </ion-toolbar>
</ion-footer>